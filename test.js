import test from 'ava'
import { preProcess, postProcess, callMondrian } from './index.js'

const data = require('./data/adult.json')
const attributes = require('./data/adult-attributes.json')
const preProcessed = [
  [39, 0, 13, 0, 0, 0, 0, 0, '<=50K'],
  [50, 1, 13, 1, 1, 0, 0, 0, '<=50K'],
  [38, 2, 9, 2, 2, 0, 0, 0, '<=50K'],
  [53, 2, 7, 1, 2, 1, 0, 0, '<=50K'],
  [28, 2, 13, 1, 3, 1, 1, 1, '<=50K'],
  [37, 2, 14, 1, 1, 0, 1, 0, '<=50K'],
  [49, 2, 5, 3, 4, 1, 1, 2, '<=50K'],
  [52, 1, 9, 1, 1, 0, 0, 0, '>50K'],
  [31, 2, 14, 0, 3, 0, 1, 0, '>50K'],
  [42, 2, 13, 1, 1, 0, 0, 0, '>50K']
]
const processed = [
  ['28,53', '0,2', '5,14', '0,3', '0,4', '0,1', '0,1', '0,2', '<=50K'],
  ['28,53', '0,2', '5,14', '0,3', '0,4', '0,1', '0,1', '0,2', '<=50K'],
  ['28,53', '0,2', '5,14', '0,3', '0,4', '0,1', '0,1', '0,2', '<=50K'],
  ['28,53', '0,2', '5,14', '0,3', '0,4', '0,1', '0,1', '0,2', '<=50K'],
  ['28,53', '0,2', '5,14', '0,3', '0,4', '0,1', '0,1', '0,2', '<=50K'],
  ['28,53', '0,2', '5,14', '0,3', '0,4', '0,1', '0,1', '0,2', '<=50K'],
  ['28,53', '0,2', '5,14', '0,3', '0,4', '0,1', '0,1', '0,2', '<=50K'],
  ['28,53', '0,2', '5,14', '0,3', '0,4', '0,1', '0,1', '0,2', '>50K'],
  ['28,53', '0,2', '5,14', '0,3', '0,4', '0,1', '0,1', '0,2', '>50K'],
  ['28,53', '0,2', '5,14', '0,3', '0,4', '0,1', '0,1', '0,2', '>50K']
]

test('preProcess', t => {
  t.deepEqual(preProcessed, preProcess(data.slice(0, 10), attributes))
})

test('mondrian', async t => {
  t.deepEqual(processed, await callMondrian(preProcessed, 20, false))
})
